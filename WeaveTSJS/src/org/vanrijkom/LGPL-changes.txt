Minimal modifications to work with FlexJS and WeaveJS.
Converted to typescript.